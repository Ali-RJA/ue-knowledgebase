<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UE5 Modular C++ Architecture: The Lego Block Bible</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        :root {
            --bg-deep: #0f172a;
            --bg-card: #1e293b;
            --accent-blue: #38bdf8;
            --accent-green: #4ade80;
            --accent-purple: #a78bfa;
            --accent-gold: #fbbf24;
            --accent-red: #f87171;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-deep) 0%, #1e293b 50%, var(--bg-deep) 100%);
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--text-main);
            padding: 20px;
            line-height: 1.6;
        }
        
        .header {
            text-align: center;
            padding: 60px 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 24px;
            margin-bottom: 40px;
            border: 1px solid var(--border);
            backdrop-filter: blur(12px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
        }
        
        .header h1 {
            font-size: 3.2rem;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple), var(--accent-gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 900;
            letter-spacing: -0.02em;
        }
        
        .header p {
            color: var(--text-muted);
            font-size: 1.3rem;
            max-width: 900px;
            margin: 0 auto;
        }

        .version-tag {
            display: inline-block;
            background: linear-gradient(90deg, #6366f1, #a855f7);
            padding: 4px 12px;
            border-radius: 100px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            text-transform: uppercase;
        }

        /* LEGEND */
        .legend {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 15px;
            margin-bottom: 40px;
            padding: 25px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid var(--border);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .legend-item:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .legend-color {
            width: 22px;
            height: 22px;
            border-radius: 6px;
            flex-shrink: 0;
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
        }
        
        .legend-text {
            font-size: 0.95rem;
            font-weight: 600;
        }

        /* PHILOSOPHY SECTION */
        .section-title {
            text-align: center;
            font-size: 2.2rem;
            margin-bottom: 40px;
            position: relative;
        }

        .section-title::after {
            content: "";
            display: block;
            width: 60px;
            height: 4px;
            background: var(--accent-blue);
            margin: 15px auto 0;
            border-radius: 2px;
        }

        .philosophy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 60px;
        }

        .phil-card {
            background: rgba(255, 255, 255, 0.02);
            padding: 35px;
            border-radius: 20px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .phil-card:hover {
            background: rgba(255, 255, 255, 0.04);
            border-color: rgba(255, 255, 255, 0.15);
            transform: translateY(-5px);
        }

        .phil-card h3 {
            color: var(--accent-blue);
            font-size: 1.5rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .phil-card p {
            color: var(--text-muted);
            font-size: 1.05rem;
        }

        /* DIAGRAM AREA */
        .diagram-outer {
            margin-bottom: 80px;
        }

        .diagram-container {
            background: #020617;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            overflow: hidden;
            position: relative;
            height: 85vh;
            cursor: grab;
            box-shadow: 0 30px 60px -12px rgba(0, 0, 0, 0.6);
        }
        
        .diagram-container:active {
            cursor: grabbing;
        }
        
        .diagram-canvas {
            position: absolute;
            top: 0;
            left: 0;
            transform-origin: 0 0;
            will-change: transform;
            padding: 60px;
        }

        .hint-bar {
            background: rgba(15, 23, 42, 0.9);
            padding: 12px 25px;
            font-size: 0.9rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border);
            backdrop-filter: blur(8px);
            position: relative;
            z-index: 10;
        }

        .controls {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 12px;
            z-index: 100;
        }

        .control-btn {
            background: rgba(30, 41, 59, 0.9);
            border: 1px solid var(--border);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            backdrop-filter: blur(4px);
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover {
            background: #334155;
            border-color: var(--accent-blue);
            color: var(--accent-blue);
            transform: scale(1.05);
        }
        
        /* QUICK REFERENCE GRID */
        .ref-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .ref-card {
            background: var(--bg-card);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.2);
        }

        .ref-card:hover {
            transform: translateY(-8px) scale(1.01);
            border-color: rgba(56, 189, 248, 0.4);
            box-shadow: 0 20px 40px -10px rgba(0,0,0,0.4);
        }

        .ref-card h3 {
            padding: 20px 25px;
            background: rgba(255, 255, 255, 0.03);
            font-size: 1.25rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 700;
        }

        .file-path {
            font-family: 'JetBrains Mono', 'Fira Code', monospace;
            font-size: 0.8rem;
            color: var(--accent-blue);
            background: #0f172a;
            padding: 5px 12px;
            border-radius: 6px;
            border: 1px solid rgba(56, 189, 248, 0.2);
        }

        .card-body {
            flex-grow: 1;
            padding: 0;
            background: #0f172a;
        }

        pre {
            padding: 25px;
            margin: 0;
            overflow-x: auto;
            font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', monospace;
            font-size: 0.95rem;
            line-height: 1.5;
        }

        .card-footer {
            padding: 15px 25px;
            background: rgba(255, 255, 255, 0.02);
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-muted);
            font-style: italic;
        }

        /* Syntax Highlighting */
        .keyword { color: #f472b6; }
        .type { color: #38bdf8; }
        .comment { color: #64748b; font-style: italic; }
        .func { color: #fbbf24; }
        .macro { color: #a78bfa; }
        .string { color: #4ade80; }
        .number { color: #fb7185; }

        /* Color classes for cards */
        .card-logic { border-top: 4px solid var(--accent-blue); }
        .card-flavor { border-top: 4px solid var(--accent-green); }
        .card-contract { border-top: 4px solid var(--accent-gold); }
        .card-data { border-top: 4px solid var(--accent-purple); }
        .card-anti { border-top: 4px solid var(--accent-red); }

        /* DEEP DIVE SECTION */
        .deep-dive {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 24px;
            padding: 50px;
            margin-bottom: 80px;
            border: 1px solid var(--border);
        }

        .deep-dive h2 {
            font-size: 2.5rem;
            margin-bottom: 30px;
            color: var(--text-main);
        }

        .deep-dive-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .deep-dive-item h4 {
            color: var(--accent-blue);
            font-size: 1.4rem;
            margin-bottom: 15px;
        }

        .deep-dive-item ul {
            padding-left: 20px;
            color: var(--text-muted);
        }

        .deep-dive-item li {
            margin-bottom: 10px;
        }

        @media (max-width: 1100px) {
            .deep-dive-grid { grid-template-columns: 1fr; }
            .ref-grid { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 2.2rem; }
            .philosophy-grid { grid-template-columns: 1fr; }
            .deep-dive { padding: 30px; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: var(--bg-deep); }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 5px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
    </style>
</head>
<body>

    <div class="header">
        <div class="version-tag">Production Standards v1.2</div>
        <h1>üß± UE5 Modular C++ Architecture</h1>
        <p>The "Lego Block" Bible: A comprehensive guide to building decoupled, reusable, and data-driven systems in Unreal Engine 5.</p>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="legend-color" style="background: var(--accent-blue);"></div>
            <span class="legend-text">C++ Logic (The Rules)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: var(--accent-green);"></div>
            <span class="legend-text">Blueprint Flavor (The Filling)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: var(--accent-gold);"></div>
            <span class="legend-text">Interfaces (The Contracts)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: var(--accent-purple);"></div>
            <span class="legend-text">Data Assets (The Configuration)</span>
        </div>
        <div class="legend-item">
            <div class="legend-color" style="background: var(--accent-red);"></div>
            <span class="legend-text">Anti-Patterns (To Avoid)</span>
        </div>
    </div>

    <div class="section-title">The Three Pillars of Modularity</div>
    <div class="philosophy-grid">
        <div class="phil-card">
            <h3>üß© Systems vs. Games</h3>
            <p>Shift focus from building a "Game" to building a "Personal Asset Library." Every feature (Inventory, Combat, AI) should be a standalone UActorComponent that can be dropped into any project without modification.</p>
        </div>
        <div class="phil-card">
            <h3>üèóÔ∏è The Sandwich Pattern</h3>
            <p>C++ classes should be "Abstract Shells." They define the logic flow and provide "slots" (TSubclassOf, TSoftObjectPtr). Blueprints then "Fill the Sandwich" with sounds, meshes, and specific visual data.</p>
        </div>
        <div class="phil-card">
            <h3>ü§ù Radical Decoupling</h3>
            <p>Use <b>Interfaces</b> to talk "Up" (to unknown actors) and <b>Delegates</b> to talk "Out" (to UI or FX). Never include a Blueprint-generated header in C++, and avoid hard-casting to specific classes whenever possible.</p>
        </div>
    </div>

    <div class="diagram-outer">
        <div class="section-title">Visualizing the Architecture</div>
        <div class="diagram-container" id="diagram-container">
            <div class="hint-bar">
                <span>üñ±Ô∏è Scroll to zoom ‚Ä¢ Drag to pan ‚Ä¢ Hover nodes for details</span>
                <span id="zoom-indicator">100%</span>
            </div>
            <div class="controls">
                <button class="control-btn" onclick="zoomIn()">üîç Zoom In</button>
                <button class="control-btn" onclick="zoomOut()">üîç Zoom Out</button>
                <button class="control-btn" onclick="resetZoom()">‚Ü∫ Reset</button>
            </div>
            <div class="diagram-canvas" id="diagram-canvas">
                <div class="mermaid" id="mermaid-diagram">
flowchart TB
    direction TB

    %% ============================================================
    %% LAYER 0: THE DATA & CONTRACT LAYER
    %% ============================================================
    subgraph LAYER0["üìÅ LAYER 0: DATA & CONTRACTS ‚îÅ‚îÅ The Blueprint-Neutral Layer"]
        direction TB
        
        I_DAMAGE["<b>IDamageable Interface</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>UINTERFACE definition<br/>Native & BP Events<br/>Shared 'Language'"]
        
        DATA_WEAPON["<b>UWeaponDataAsset</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>BaseDamage: float<br/>ComboStrings: TArray<br/>Icon: TSoftObjectPtr"]
        
        I_INTERACT["<b>IInteractable Interface</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Interact(Actor* Interactor)<br/>Allows generic trigger logic"]
    end

    %% LAYER 0 NOTES
    subgraph L0_NOTES["üìù DATA LAYER NOTES"]
        L0_Q["<b>‚ùì Why Interfaces?</b><br/>Allows a Trap actor to hurt<br/>a Player, a Destructible Crate,<br/>and an NPC without knowing<br/>ANY of their class types."]
        L0_G["<b>‚ö†Ô∏è Data Asset Tip</b><br/>Always use TSoftObjectPtr for<br/>heavy assets (Skeletal Meshes)<br/>to keep your memory footprint<br/>low during loading."]
        L0_Q ~~~ L0_G
    end

    %% ============================================================
    %% LAYER 1: THE C++ LOGIC LAYER
    %% ============================================================
    subgraph LAYER1["‚öôÔ∏è LAYER 1: C++ RULES ‚îÅ‚îÅ The 'Bread' of the Sandwich"]
        direction TB
        
        CPP_CHAR["<b>ACharacterBase</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Handles Movement Logic<br/>Owns CombatComponent<br/>Calls Interfaces"]
        
        CPP_COMP["<b>UCombatComponent</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Manages State Machine<br/>Executes Actions<br/>Broadcasts Delegates"]
        
        CPP_ACT["<b>UActionExecutor</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Polymorphic Logic<br/>Damage / Heal / Buff<br/>Generic Payload"]
    end

    %% LAYER 1 NOTES
    subgraph L1_NOTES["üìù LOGIC LAYER NOTES"]
        L1_Q["<b>‚ùì Forward Declarations</b><br/>Use 'class AMyActor;' in headers.<br/>Only #include in .cpp files.<br/>Crucial for compile times!"]
        L1_C["<b>üìç ExecuteAction()</b><br/>void Execute(UActionData* D)<br/>{<br/>  D->Apply(this, Target);<br/>}"]
        L1_Q ~~~ L1_C
    end

    %% ============================================================
    %% LAYER 2: THE BLUEPRINT FLAVOR LAYER
    %% ============================================================
    subgraph LAYER2["üé® LAYER 2: BP FLAVOR ‚îÅ‚îÅ The 'Filling' of the Sandwich"]
        direction TB
        
        BP_HERO["<b>BP_PlayerCharacter</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Assigns Hero Mesh<br/>Sets Camera FOV<br/>Visual Death Logic"]
        
        BP_SWORD["<b>BP_Longsword</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Child of AWeaponBase<br/>Assigns Sound_Clash<br/>Assigns FX_Spark"]
        
        BP_UI["<b>WBP_HealthBar</b><br/>‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ<br/>Listens to Delegates<br/>Animates Progress Bars<br/>Decoupled from Actor"]
    end

    %% ============================================================
    %% FLOWS
    %% ============================================================
    BP_HERO -- "Inherits" --> CPP_CHAR
    CPP_CHAR -- "Uses" --> CPP_COMP
    CPP_COMP -- "TSubclassOf" --> BP_SWORD
    
    BP_SWORD -- "Inherits" --> CPP_ACT
    CPP_ACT -- "Reads" --> DATA_WEAPON
    CPP_ACT -- "Talks to" --> I_DAMAGE
    
    I_DAMAGE -. "Implemented By" .-> BP_HERO
    CPP_COMP -- "Broadcasts" --> BP_UI

    %% STYLING
    classDef logic fill:#075985,stroke:#38bdf8,color:#fff
    classDef flavor fill:#064e3b,stroke:#4ade80,color:#fff
    classDef contract fill:#78350f,stroke:#fbbf24,color:#fff
    classDef data fill:#4c1d95,stroke:#a78bfa,color:#fff
    classDef note fill:#1e293b,stroke:#475569,color:#cbd5e1,font-size:12px

    class CPP_CHAR,CPP_COMP,CPP_ACT logic
    class BP_HERO,BP_SWORD,BP_UI flavor
    class I_DAMAGE,I_INTERACT contract
    class DATA_WEAPON data
    class L0_Q,L0_G,L1_Q,L1_C note
                </div>
            </div>
        </div>
    </div>

    <div class="section-title">Quick Code Reference (The 80/20 of Modularity)</div>
    <div class="ref-grid">
        <!-- 1. MODULAR INTERFACE -->
        <div class="ref-card card-contract">
            <h3>1. The Modular Interface <span class="file-path">IDamageable.h</span></h3>
            <div class="card-body">
                <pre><code><span class="macro">UINTERFACE</span>(MinimalAPI)
<span class="keyword">class</span> <span class="type">UDamageable</span> : <span class="keyword">public</span> <span class="type">UInterface</span> { <span class="macro">GENERATED_BODY</span>() };

<span class="keyword">class</span> <span class="type">IDamageable</span> {
    <span class="macro">GENERATED_BODY</span>()
<span class="keyword">public</span>:
    <span class="comment">// BlueprintNativeEvent = C++ can implement, BP can override</span>
    <span class="macro">UFUNCTION</span>(BlueprintNativeEvent, Category=<span class="string">"Combat"</span>)
    <span class="keyword">void</span> <span class="func">TakeDamage</span>(<span class="type">float</span> Amount, <span class="type">AActor*</span> Causer);
};</code></pre>
            </div>
            <div class="card-footer">Used for "I don't care who you are" communication.</div>
        </div>

        <!-- 2. THE SANDWICH SLOT -->
        <div class="ref-card card-logic">
            <h3>2. The "Sandwich" Slot <span class="file-path">WeaponBase.h</span></h3>
            <div class="card-body">
                <pre><code><span class="macro">UPROPERTY</span>(EditDefaultsOnly, Category=<span class="string">"VFX"</span>)
<span class="type">TSubclassOf&lt;AActor&gt;</span> ImpactEffectClass;

<span class="keyword">void</span> <span class="func">ProcessHit</span>(<span class="type">FHitResult</span> Hit) {
    <span class="comment">// C++ logic handles the timing/math</span>
    <span class="keyword">if</span> (ImpactEffectClass) {
        <span class="comment">// BP provides the actual visual asset</span>
        GetWorld()-><span class="func">SpawnActor</span>(ImpactEffectClass, Hit.ImpactPoint, ...);
    }
}</code></pre>
            </div>
            <div class="card-footer">Decouples core logic from specific visual assets.</div>
        </div>

        <!-- 3. GENERIC ACTION EXECUTOR -->
        <div class="ref-card card-logic">
            <h3>3. Polymorphic Action <span class="file-path">CombatComp.cpp</span></h3>
            <div class="card-body">
                <pre><code><span class="comment">// Instead of DealDamage(), HealPlayer(), GiveBuff()...</span>
<span class="keyword">void</span> <span class="func">ExecuteAction</span>(<span class="type">UActionEffect*</span> Effect, <span class="type">AActor*</span> Target) {
    <span class="keyword">if</span> (Effect) {
        <span class="comment">// Polymorphism: The Effect class knows HOW to apply itself</span>
        Effect-><span class="func">Apply</span>(<span class="keyword">this</span>->GetOwner(), Target);
    }
}</code></pre>
            </div>
            <div class="card-footer">Ambiguity allows for infinite expansion without code changes.</div>
        </div>

        <!-- 4. SAFE INTERFACE CALLING -->
        <div class="ref-card card-contract">
            <h3>4. Safe Interface Call <span class="file-path">Projectile.cpp</span></h3>
            <div class="card-body">
                <pre><code><span class="keyword">void</span> <span class="func">OnOverlap</span>(<span class="type">AActor*</span> Other) {
    <span class="comment">// Native check for Interface implementation</span>
    <span class="keyword">if</span> (Other-><span class="func">Implements</span>&lt;<span class="type">UDamageable</span>&gt;()) {
        <span class="comment">// Note the "Execute_" prefix for NativeEvents</span>
        <span class="type">IDamageable</span>::<span class="func">Execute_TakeDamage</span>(Other, <span class="number">25.0f</span>, <span class="keyword">this</span>);
    }
}</code></pre>
            </div>
            <div class="card-footer">Always use the Execute_ wrapper to support BP overrides.</div>
        </div>

        <!-- 5. DATA-DRIVEN CONFIG -->
        <div class="ref-card card-data">
            <h3>5. Primary Data Asset <span class="file-path">ItemData.h</span></h3>
            <div class="card-body">
                <pre><code><span class="macro">UCLASS</span>(BlueprintType)
<span class="keyword">class</span> <span class="type">UItemData</span> : <span class="keyword">public</span> <span class="type">UPrimaryDataAsset</span> {
    <span class="macro">GENERATED_BODY</span>()
<span class="keyword">public</span>:
    <span class="macro">UPROPERTY</span>(EditAnywhere) <span class="type">FText</span> ItemName;
    <span class="macro">UPROPERTY</span>(EditAnywhere) <span class="type">TSoftObjectPtr&lt;USkeletalMesh&gt;</span> Mesh;
};</code></pre>
            </div>
            <div class="card-footer">DataAssets are the "source of truth" for designers.</div>
        </div>

        <!-- 6. DECOUPLED DELEGATES -->
        <div class="ref-card card-logic">
            <h3>6. Multicast Delegates <span class="file-path">HealthComp.h</span></h3>
            <div class="card-body">
                <pre><code><span class="macro">DECLARE_DYNAMIC_MULTICAST_DELEGATE_OneParam</span>(
    FOnHealthChanged, <span class="type">float</span>, NewPercent
);

<span class="macro">UPROPERTY</span>(BlueprintAssignable)
<span class="type">FOnHealthChanged</span> OnHealthChanged;

<span class="comment">// Broadcast in C++, UI listens in BP</span>
OnHealthChanged.<span class="func">Broadcast</span>(CurrentHealth / MaxHealth);</code></pre>
            </div>
            <div class="card-footer">Broadcaster doesn't know (or care) who is listening.</div>
        </div>

        <!-- 7. THE NATIVE/BP PATTERN -->
        <div class="ref-card card-logic">
            <h3>7. The Implementation Pattern <span class="file-path">BaseActor.h</span></h3>
            <div class="card-body">
                <pre><code><span class="comment">// In Header</span>
<span class="macro">UFUNCTION</span>(BlueprintNativeEvent)
<span class="keyword">void</span> <span class="func">OnDeath</span>();

<span class="comment">// In .cpp (Note the suffix)</span>
<span class="keyword">void</span> <span class="type">ABaseActor</span>::<span class="func">OnDeath_Implementation</span>() {
    <span class="comment">// Default C++ logic (e.g., destroy timer)</span>
}</code></pre>
            </div>
            <div class="card-footer">Allows C++ to provide base logic that BPs can extend.</div>
        </div>

        <!-- 8. FORWARD DECLARATIONS -->
        <div class="ref-card card-logic">
            <h3>8. Build Speed optimization <span class="file-path">MyClass.h</span></h3>
            <div class="card-body">
                <pre><code><span class="comment">// Instead of #include "HeavyCharacter.h"</span>
<span class="keyword">class</span> <span class="type">AHeroCharacter</span>; 

<span class="macro">UCLASS</span>()
<span class="keyword">class</span> <span class="type">UMyComponent</span> : <span class="keyword">public</span> <span class="type">UActorComponent</span> {
    <span class="macro">UPROPERTY</span>() <span class="type">AHeroCharacter*</span> CachedHero;
};</code></pre>
            </div>
            <div class="card-footer">Reduces header dependencies and drastically speeds up compiles.</div>
        </div>

        <!-- 9. COMPONENT DISCOVERY -->
        <div class="ref-card card-logic">
            <h3>9. Finding Modular Logic <span class="file-path">Interaction.cpp</span></h3>
            <div class="card-body">
                <pre><code><span class="keyword">void</span> <span class="func">Interact</span>(<span class="type">AActor*</span> Target) {
    <span class="comment">// Look for behavior, not class type</span>
    <span class="type">UInventoryComp*</span> Inv = Target-><span class="func">FindComponentByClass</span>&lt;<span class="type">UInventoryComp</span>&gt;();
    
    <span class="keyword">if</span> (Inv) {
        Inv-><span class="func">AddItem</span>(MyItem);
    }
}</code></pre>
            </div>
            <div class="card-footer">Enables components to work on ANY actor type.</div>
        </div>

        <!-- 10. SOFT REFERENCES -->
        <div class="ref-card card-data">
            <h3>10. Async Asset Loading <span class="file-path">AssetLoader.cpp</span></h3>
            <div class="card-body">
                <pre><code><span class="type">TSoftObjectPtr&lt;UStaticMesh&gt;</span> MeshPtr = ...;

<span class="keyword">if</span> (MeshPtr.<span class="func">IsPending</span>()) {
    <span class="comment">// Load without blocking the game thread</span>
    <span class="type">FStreamableManager</span>& Streamable = ...;
    Streamable.<span class="func">RequestAsyncLoad</span>(MeshPtr.ToSoftObjectPath(), ...);
}</code></pre>
            </div>
            <div class="card-footer">Crucial for open-world or asset-heavy games.</div>
        </div>
    </div>

    <div class="section-title">üö´ The Anti-Pattern Gallery</div>
    <div class="ref-grid">
        <div class="ref-card card-anti">
            <h3>The Casting Spiderweb</h3>
            <div class="card-body">
                <pre><code><span class="comment">// BAD: Rigidly tied to one specific class</span>
<span class="keyword">if</span> (<span class="type">APlayerCharacter*</span> P = <span class="func">Cast</span>&lt;<span class="type">APlayerCharacter</span>&gt;(Actor)) {
    P-><span class="func">OpenDoor</span>();
}

<span class="comment">// GOOD: Uses Interfaces</span>
<span class="keyword">if</span> (Actor-><span class="func">Implements</span>&lt;<span class="type">UOpenable</span>&gt;()) {
    <span class="type">IOpenable</span>::<span class="func">Execute_OpenDoor</span>(Actor);
}</code></pre>
            </div>
            <div class="card-footer">Casting creates hidden dependencies that make refactoring a nightmare.</div>
        </div>

        <div class="ref-card card-anti">
            <h3>Hard-Coded Asset Paths</h3>
            <div class="card-body">
                <pre><code><span class="comment">// BAD: Path breaks if asset is moved/renamed</span>
<span class="keyword">static</span> <span class="type">ConstructorHelpers::FObjectFinder&lt;UStaticMesh&gt;</span> Mesh(
    <span class="string">"/Game/Art/Meshes/SM_Sword.SM_Sword"</span>
);

<span class="comment">// GOOD: Use UPROPERTY</span>
<span class="macro">UPROPERTY</span>(EditDefaultsOnly) <span class="type">UStaticMesh*</span> SwordMesh;</code></pre>
            </div>
            <div class="card-footer">Never hard-code paths in C++. Always expose them to Blueprints.</div>
        </div>
    </div>

    <div class="deep-dive">
        <h2>üß† Deep Dive: Advanced Modularity</h2>
        <div class="deep-dive-grid">
            <div class="deep-dive-item">
                <h4>Why Use Primary Data Assets?</h4>
                <ul>
                    <li><b>Asset Manager Integration:</b> They can be discovered and loaded by the Asset Manager at runtime without hard references.</li>
                    <li><b>Editor Utility:</b> They provide a clean, dedicated UI for designers to tweak values without opening complex Blueprints.</li>
                    <li><b>Memory Management:</b> They act as lightweight descriptors for heavy assets.</li>
                </ul>
            </div>
            <div class="deep-dive-item">
                <h4>The "Component-First" Mentality</h4>
                <ul>
                    <li>Avoid putting logic in the Character class. A Character should be a "Manager" of components.</li>
                    <li><b>HealthComponent:</b> Handles HP, damage, and death logic.</li>
                    <li><b>InventoryComponent:</b> Handles items and storage.</li>
                    <li><b>CombatComponent:</b> Handles combos, states, and weapon logic.</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Mermaid Initialization
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark',
            securityLevel: 'loose',
            flowchart: { useMaxWidth: false, htmlLabels: true }
        });

        // Pan and Zoom Logic
        const container = document.getElementById('diagram-container');
        const canvas = document.getElementById('diagram-canvas');
        const indicator = document.getElementById('zoom-indicator');

        let scale = 1;
        let isDragging = false;
        let startX, startY, translateX = 60, translateY = 60;

        function updateTransform() {
            canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
            indicator.innerText = `${Math.round(scale * 100)}%`;
        }

        container.addEventListener('mousedown', (e) => {
            if (e.button === 0) {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
            }
        });

        window.addEventListener('mousemove', (e) => {
            if (isDragging) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
            }
        });

        window.addEventListener('mouseup', () => isDragging = false);

        container.addEventListener('wheel', (e) => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            const newScale = Math.min(Math.max(scale * delta, 0.2), 3);
            
            // Zoom towards mouse position
            const rect = container.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            translateX = mouseX - (mouseX - translateX) * (newScale / scale);
            translateY = mouseY - (mouseY - translateY) * (newScale / scale);
            
            scale = newScale;
            updateTransform();
        }, { passive: false });

        function zoomIn() { scale = Math.min(scale * 1.2, 3); updateTransform(); }
        function zoomOut() { scale = Math.max(scale * 0.8, 0.2); updateTransform(); }
        function resetZoom() { scale = 1; translateX = 60; translateY = 60; updateTransform(); }

        // Initial setup
        window.addEventListener('load', () => {
            setTimeout(updateTransform, 500);
        });
    </script>
</body>
</html>